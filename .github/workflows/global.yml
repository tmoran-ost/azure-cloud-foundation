# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

trigger:
  branches:
    include:
      - main
  paths:
    include: 
    - 'tf/env/global/foundation/*'

variables:
    environmentName: global
    serviceName: foundation
    terraformVersion: 1.1.5
    terraformResourceGroup: rg-global-devops-<location-prefix>
    terraformStorageAccount: storage-account-name
          
pool:
    vmImage: 'ubuntu-latest'

name: $(TeamProject)_$(Build.DefinitionName)_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:.r)
stages:
- template: ../templates/terraform-plan.yml
  parameters:
    serviceConnection: ${{ variables.environmentName }}
    environmentName: ${{ variables.environmentName }}
    serviceName: ${{ variables.serviceName }}
    terraformVersion: ${{ variables.terraformVersion }}
    terraformResourceGroup: ${{ variables.terraformResourceGroup }}
    terraformStorageAccount: ${{ variables.terraformStorageAccount }}
